# h4 Omat komennot

Nämä tehtävät ovat neljännen viikon tehtäviä Haaga-Helia ammattikorkeakoulun kurssilla "Palvelinten hallinta". Tehtävänannot löytyvät osoitteesta: https://terokarvinen.com/2022/palvelinten-hallinta-2022p2/?fromSearch=palvelinten%20hallinta#h4-omat-komennot

Tehtävät on suoritettu XXXX välisenä aikana. Alla ympäristön listaus:

Pääkone:

- Kannettava tietokone: Lenovo IdeaPad 5 Pro
- Käyttöjärjestelmä: Microsoft Windows 11 Home
- Prosessori: AMD Ryzen 7 5800U with Radeon Graphics
- RAM: 16 GB
- Tähän asennettu virtuaalikone

Virtuaalikone:

- Oracle VirtualBox 6.1.40
- Käyttöjärjestelmä: Debian 11 64-bit
- RAM: 4GB
- Levytila: 60GB

## a) Hei komento! Tee järjestelmään uusi "hei maailma" -komento ja asenna se orjille Saltilla. Liitä raporttiisi orjan 'ls -l /usr/local/bin/' tulosteesta ainakin se rivi, jolla näkyy uuden komentotiedostosi oikeudet.

Ensimmäisenä testasin pelkkää "hei maailma" tulostusta komennolla `echo "Hei Maailma`. 

    leenam@linuxkurssi:~$ echo "Hei Maailma"
    Hei Maailma

Minulla oli jo tunnilla kotihakemistossa luotuna kansio "scripts". Päätin tämän tehtävän luoda sinne, jotta kaikki skriptit löytyy jatkossa samasta paikasta. Eli menin kyseiseen kansioon. Loin sinne tiedoston harjoitus1 komennolla `micro harjoitus1.sh`. Kopioin sisälle aiemman 'echo "Hei Maailma!"'. Kokeilin hakemistossa ajaa komennon `bash harjoitus1.sh`, ja konsoliin tulostui "Hei Maailma". Kävin lisäämässä tiedoston alkuun "#!/usr/bin/bash", jotta tätä pystytään nimenomaan bashilla ajaa ja orjille tämä skripti tallentuu binin hakemistoon. Tarkistin vielä hakemistoni missä olen. Harjoitus1 näkyy vain tiedostona, sillä sitä ei ole vielä jaettu orjille, kuten muita vanhohja skritiharjoituksia. 

![image](https://user-images.githubusercontent.com/111494018/203002876-11854c2c-4008-473f-b200-e04581359f3d.png)
    
Siirryin saltin tietoihin komennolla `cd /srv/salt` ja loin sinne hakemiston tätä harjoitusta varten `sudo mkdir harjoitus1tila`. Menin kyseiseen hakemistoon. Loin sisälle tiedoston `micro init.sls`, johon määrittelen ajoasetukset.

    /usr/local/bin/harjoitus1:
      file.managed:
        - source: salt://harjoitus1tila/

Tässä kohti tajusin, etten ollut oikeuksia muokannut. Joten palasin takaisin scripts hakemistooni. Muutin harjoitus1 tiedoston oikeudet niin, että muut ryhmään kuuluvilla on exceute, eli x, oikeus. Komentona käytin `chmod ugo+x harjoitus1.sh` Eli jotta kaikki pystyvät hakemistossa olevan skriptin ajamaan. Tarkistin onko oikeudet nyt oikein komennolla `ls -l harjoitus1`. Ja viimeisellä muut ryhmällä oli nyt x oikeudet. Tässä kohti olisin tietenkin voinut ennen muutosta katsoa, mitkä alkuperäiset oikeudet olivat.
   
    leenam@linuxkurssi:~/scripts$ chmod ugo+x harjoitus1.sh
    leenam@linuxkurssi:~/scripts$ ls -l harjoitus1.sh 
    -rwxr-xr-x 1 leenam leenam 37 21.11. 10:32 harjoitus1.sh
    
Tarkistin, mitä kyseiset oikeudet numeroina tarkoittaa, jotta voin tämän määritellä saltiin. Tarkistin komennolla `stat harjoitus1.sh`. Kyseiset oikeudet vastaa numerokoodia 0755. 

![image](https://user-images.githubusercontent.com/111494018/203006875-6bccf8a4-4381-4a0c-9e6a-a292502ba2e1.png)

Menin takaisin salt tilan asetuksiin. Lisäsin tilan asetustiedosoon mode: 0755. Eli asetustiedosto näyttää nyt tältä:

    /usr/local/bin/harjoitus1:
      file.managed:
        - source: salt://harjoitus1tila/
        - mode: 0755

Yritin ajaa tilan paikallisesti `sudo salt-call --local state.apply harjoitus1tila`, mutta sain epäonnistuneen ajon. 

![image](https://user-images.githubusercontent.com/111494018/203007500-891a5b1c-991f-4168-8700-5ce3dd7fd010.png)

Tässä syynä, etten ole kopioinut alkuperäistä skriptitiedostoa saltin tiedostoihin, eli salt komento ei sitä vielä lue. Menin takaisin scripts hakemistooni ja kopioin harjoitus1.sh tiedoston binin hakemistoon komennolla `sudo cp harjoitus1.sh /srv/salt/harjoitus1tila`. Kävin kyseisestä hakemistosta `cd /srv/salt/harjoitus1tila` tarkistamassa, että harjoitus1.sh löytyy nyt sieltä. Löytyihän se. 

    leenam@linuxkurssi:~/scripts$ sudo cp harjoitus1.sh /srv/salt/harjoitus1tila
    leenam@linuxkurssi:~/scripts$ cd /srv/salt/harjoitus1tila
    leenam@linuxkurssi:/srv/salt/harjoitus1tila$ ls
    harjoitus1.sh  init.sls
    
Kokeilin taas tilan ajoa paikallisesti. `sudo salt-call --local state.apply harjoitus1tila`, mutta jälleen epäonnistuminen. Menin takaisin tutkimaan saltin asetustiedostoa. Huomasin, etten ollut määritellyt itse tiedostoa. Eli lisäsin harjoitus1.sh sourceen. 

    /usr/local/bin/harjoitus1:
      file.managed:
        - source: salt://harjoitus1tila/harjoitus1.sh
        - mode: 0755
        
Nyt tilan ajo onnistui. 

![image](https://user-images.githubusercontent.com/111494018/203010748-6d806fa6-f42e-4ceb-bd7c-6412b06e95d7.png)

Tein ajon vielä orjille komennolla `sudo salt '*' state.apply harjoitus1tila`. Tuli ilmoitus, että kaikki on jo kunnossa. Tämä siksi, että minulla on vain paikallisesti asennettu yksi orja, jolle ajo oli jo mennyt edellisessä kohdassa. 
    
![image](https://user-images.githubusercontent.com/111494018/203011052-053a5c81-e26a-4cd8-a130-dcad1aa2eb2e.png)

Halusin testata skriptin toimivuutta muualla, joten menin kotihakemistooni `cd` ja ajoin skriptin komennon `harjoitus1`. Skripti toimi ja tulostui "Hei Maailma"

    leenam@linuxkurssi:/srv/salt/harjoitus1tila$ cd
    leenam@linuxkurssi:~$ harjoitus1
    Hei Maailma

Lopuksi tarkistin vielä pyydetyt orjan oikeudet kyseiseen skriptiin komennolla `ls -l /usr/local/bin/`. Sain vastauksen:

    -rwxr-xr-x 1 root root   37 21.11. 10:59 harjoitus1.sh

Eli on haluttu execute oikeus.


## b) whatsup.sh. Tee järjestelmään uusi komento, joka kertoo ajankohtaisia tietoja; asenna se orjille. Vinkkejä: Voit näyttää valintasi mukaan esimerkiksi päivämäärää, säätä, tietoja koneesta, verkon tilanteesta...

## c) hello.py. Tee järjestelmään uusi komento Pythonilla ja asenna se orjille. Vinkkejä: Hei maailma riittää, mutta propellihatut saavat toki koodaillakin. Shebang on "#!/usr/bin/python3". Helpoin Python-komento on: print("Hei Tero!")

## d) Laiskaa skriptailua. Tee kansio, josta jokainen skripti kopioituu orjille.

## e) Intel. Etsi kolme loppuprojektia joltain vanhalta kurssitoteutukselta. Kuvaile projektit tiiviisti, viittaa ja linkitä alkuperäiseeen raporttin. Tässä alakohdassa ei tarvitse vielä kokeilla mitään koneella, vaan voit kuvailla niitä oheismateriaalin perusteella.

## e) Lukua, ei luottamusta. Kokeile yhtä kohdassa d-Intel löytämääsi modulia koneella. Tämä on infraa koodina, joten luottamusta ei tarvita. Voit lukea koodista, mitä olet ajamassa.

### Lähteet:

T. Karvinen. H4 Omat komennot. Configuration Management Systems - Palvelinten Hallinta 2022. URL: https://terokarvinen.com/2022/palvelinten-hallinta-2022p2/?fromSearch=palvelinten%20hallinta#h4-omat-komennot
