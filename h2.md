# Raportti h2 Package-File-Service

Nämä tehtävät ovat toisen viikon tehtäviä Haaga-Helia ammattikorkeakoulun kurssilla "Palvelinten hallinta". Tehtävänannot löytyvät osoitteesta: *XXXX*

Tehtävät on suoritettu *XXXXXX* välisenä aikana. Alla ympäristön listaus:

Pääkone:
- Kannettava tietokone: Lenovo IdeaPad 5 Pro
- Käyttöjärjestelmä: Microsoft Windows 11 Home
- Prosessori: AMD Ryzen 7 5800U with Radeon Graphics
- RAM: 16 GB
- Tähän asennettu virtuaalikone

Virtuaalikoneet:

- Oracle VirtualBox 6.1.40
- Käyttöjärjestelmä: Debian 11 64-bit
- RAM: 4GB
- Levytila: 60GB


## x) Lue ja tiivistä

Karvinen 2018: Salt Quickstart - Salt Stack Master and Slave on Ubuntu Linux
- Tekstiä (Karvinen, 2018).

Salt official documentation: Salt Getting Started Guide-kirjasta luvut Understanding SaltStack ja SaltStack Fundamentals ja SaltStack Configuration Management: Functions
- Tekstiä (Saltstack, 2016).


## a) Demonin asetukset. Säädä jokin demoni (asenna+tee asetukset+testaa) package-file-service -rakenteella. Ensin käsin: muista tehdä ja raportoida asennus ensin käsin, vasta sitten automatisoiden. Jos osaat hyvin, voit tehdä jonkin eri asetuksen kuin tunnilla. Harjoitusta varten tulee siis tehdä alusta ja raportoida samalla.

Aloitin tehtävän poistamalla ssh-demonin komennolla `sudo apt-get purge ssh`, jotta voin asentaa sen uudelleen package-file-service rakenteella. Tarkistin koneeni IP-osoitteen komennolla `hostname -I`. Yritin ottaa siihen ssh-yhteyden komennolla `ssh leenam@10.0.2.15`. Sain kuitenkin yhteyden, joten lähdin poistamaan lisää tiedostoja. Poistin myös tiedostoja komennolla `sudo apt-get purge openssh*` ja `sudo apt-get purge ssh*`. Tähti tarkoittaa, että poistetaan kaikki tiedostot, jotka alkavat openssh ja ssh-alkuisesti. Tämän jälkeen kokeilin ottaa uudelleen yhteyttä, joka epäonnistui. 


       leenam@linuxkurssi:~$ ssh leenam@10.0.2.15
       bash: /usr/bin/ssh: No such file or directory

Seuraavaksi asensin ssh takaisin komennolla `sudo apt-get install ssh`. Sain ilmoituksen, joka varoittaa vääränlaisesta käytöksestä ssh liittyen. Tämän selittää se, että kyseinen yhteys on juuri poistettu ja taas yritetään uudestaan, mikä kuulostaa tietenkin hämärältä.

       leenam@linuxkurssi:~$ ssh leenam@10.0.2.15
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
      @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
      IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
      Someone could be eavesdropping on you right now (man-in-the-middle attack)!
      It is also possible that a host key has just been changed.
      The fingerprint for the ECDSA key sent by the remote host is
      SHA256:vH9xXI9UhV+BYk7muIlam/avyuNRLymGLfLL4l0R330.
      Please contact your system administrator.
      Add correct host key in /home/leenam/.ssh/known_hosts to get rid of this message.
      Offending ECDSA key in /home/leenam/.ssh/known_hosts:3
        remove with:
        ssh-keygen -f "/home/leenam/.ssh/known_hosts" -R "10.0.2.15"
      ECDSA host key for 10.0.2.15 has changed and you have requested strict checking.
      Host key verification failed.

Poistin varoituksen ohjeiden mukaisesti komennolla `ssh-keygen -f "/home/leenam/.ssh/known_hosts" -R "10.0.2.15"`. 

      leenam@linuxkurssi:~$ ssh-keygen -f "/home/leenam/.ssh/known_hosts" -R "10.0.2.15"
      # Host 10.0.2.15 found: line 3
      /home/leenam/.ssh/known_hosts updated.
      Original contents retained as /home/leenam/.ssh/known_hosts.old
      
Nyt kokeilin ssh yhteyttä uudestaan komennolla `ssh leenam@10.0.2.15`. Pääsin sisälle. Lopuksi komennolla `exit` poistun ssh-yhteydestä.

      leenam@linuxkurssi:~$ ssh leenam@10.0.2.15
      The authenticity of host '10.0.2.15 (10.0.2.15)' can't be established.
      ECDSA key fingerprint is SHA256:vH9xXI9UhV+BYk7muIlam/avyuNRLymGLfLL4l0R330.
      Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
      Warning: Permanently added '10.0.2.15' (ECDSA) to the list of known hosts.
      leenam@10.0.2.15's password: 
      Linux linuxkurssi 5.10.0-17-amd64 #1 SMP Debian 5.10.136-1 (2022-08-13) x86_64

      The programs included with the Debian GNU/Linux system are free software;
      the exact distribution terms for each program are described in the
      individual files in /usr/share/doc/*/copyright.

      Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
      permitted by applicable law.
      Last login: Mon Nov  7 09:52:24 2022 from 10.0.2.15
      leenam@linuxkurssi:~$ exit
      logout
      Connection to 10.0.2.15 closed.
      
 Kävin muokkaamassa ssh:n asennustiedostoa komennolla `sudoedit /etc/ssh/sshd_config` ja lisäsin sallituksi portiksi 8888.
 
<img width="227" alt="image" src="https://user-images.githubusercontent.com/111494018/200261940-762a5168-56be-4e70-9d2f-5b04b95aa742.png">

Yritin ottaa nyt ssh yhtyden kyseiselle portille 8888, mutta se epäonnistui. Käynnistin ssh paketin uudestaan komennolla `sudo systemctl restart ssh`. Nyt otin ssh yhteyden portille 8888 komennolla `ssh -p 8888 leenam@10.0.2.15` ja se onnistui. 

       leenam@linuxkurssi:/$ ssh -p 8888 leenam@10.0.2.15
       ssh: connect to host 10.0.2.15 port 8888: Connection refused
       leenam@linuxkurssi:/$ sudo systemctl restart ssh
       leenam@linuxkurssi:/$ ssh -p 8888 leenam@10.0.2.15
       leenam@10.0.2.15's password: 
       Linux linuxkurssi 5.10.0-17-amd64 #1 SMP Debian 5.10.136-1 (2022-08-13) x86_64

       The programs included with the Debian GNU/Linux system are free software;
       the exact distribution terms for each program are described in the
       individual files in /usr/share/doc/*/copyright.

       Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
       permitted by applicable law.
       Last login: Mon Nov  7 10:07:26 2022 from 10.0.2.15


## b) Asenna Salt herra-orja niin, että molemmat ovat samalla koneella. Voit tehdä ne esimerkiksi uudelle virtuaalikoneelle, niin pääset kokeilemaan puhtaalta pöydältä.

Lähdin tekemään tätä harjoitusta tyhjällä virtuaalikoneella, jotta voin samalla kaiken harjoitella alusta. Asensin Saltin, herran ja orjat komennolla `sudo apt-get install salt-master salt-minion`. Päätin, että asennan Apachen, sillä se puuttuu kokonaan tältä virtuaalikoneelta. Katsoin koneeni IP-osoitteen komennolla `hostname -I` ja kävin tämän muokkaamassa orjien asetustiedostoon, jotta orjat saavat Herrakoneeseen yhteyden. Muokkaamisen tein `sudoedit /etc/salt/minion` ja lisäsin master: IP-soite.

<img width="421" alt="image" src="https://user-images.githubusercontent.com/111494018/200279138-ce61b44f-5eda-4daf-bad9-0b4f1633a66b.png">

Tämän jälkeen käynnistin orjan uudestaan, jotta muutetut asetukset otetaan käyttöön. Uudelleenkäynnistyksen tein komennolla `sudo systemctl restart salt-minion`.

       leena2@Leenakone2:~$ sudoedit /etc/salt/minion
       leena2@Leenakone2:~$ sudo systemctl restart minion
       Failed to restart minion.service: Unit minion.service not found.
       leena2@Leenakone2:~$ sudo systemctl restart salt-minion
       
Tarkistin `sudo systemctl status salt-minion`, että orja on käynnissä. Vihreä activate teksti kertoo, että orja on päällä.

<img width="489" alt="image" src="https://user-images.githubusercontent.com/111494018/200279829-9ce66f13-2b32-4dd4-9ae6-6715ba3c3a7a.png">




## c) Aja jokin tila paikallisesti ilman master-slave arkkitehtuuria. Analysoi debug-tulostetta. 'sudo salt-call --local state.apply hellotero -l debug'

## d) Vapaaehtoinen: Asenna Salt herra ja orja eri koneille.

### Lähteet:
T. Karvinen. 2018. Salt Quickstart - Salt Stack Master Slave on Ubuntu Linux. URL: https://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/

Saltstack. 2016. SaltStack Get Started. URL: https://docs.saltproject.io/en/getstarted/
