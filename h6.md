# h6 Kulkurin projekti

Nämä tehtävät ovat ensimmäisen kuudennen tehtäviä Haaga-Helia ammattikorkeakoulun kurssilla "Palvelinten hallinta". Tehtävänannot löytyvät osoitteesta: https://terokarvinen.com/2022/palvelinten-hallinta-2022p2/?fromSearch=palvelinten%20hallinta#h6-kulkurin-projekti

Tehtävät on suoritettu 30.10.2022-1.11.2022 välisenä aikana. Alla ympäristön listaus:

Pääkone:

- Kannettava tietokone: Lenovo IdeaPad 5 Pro
- Käyttöjärjestelmä: Microsoft Windows 11 Home
- Prosessori: AMD Ryzen 7 5800U with Radeon Graphics
- RAM: 16 GB
- Tähän asennettu VirtualBox, jolle harjoituksissa luodaan uusia virtuaalikoneita

Virtuaalikoneet:

- Oracle VirtualBox 6.1.40
- Käyttöjärjestelmä: Debian 11 Bullseye 64-bit


## x) Lue ja tiivistä (muutamalla ranskalaisella viivalla per artikkeli, poimi esim itsellesi keskeisimmät komennot) (Karvinen, 2022)

### Karvinen 2017: Vagrant Revisited – Install & Boot New Virtual Machine in 31 seconds (Suosittelen käyttämään tässä koneena 'vagrant init debian/bullseye64') 

### Karvinen 2021: Two Machine Virtual Network With Debian 11 Bullseye and Vagrant

### Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux

## a) Hello Vagrant. Asenna virtuaalikone Vagrantilla. (Karvinen, 2022)

Ehdin jo tunnilla asentaa Vagrantin pääkoneelleni Windowsille. Eli itse lataus tässä tehtävässä on vain muistiinpanoa tunnilta. 
Latasin ohjelman osoitteesta https://developer.hashicorp.com/vagrant/downloads ja menin ylläpitäjänä PowerShellin kautta Downloads kansiooni ja latasin Vagrantin. 
VirtualBox on ollut minulla jo vuoden verran asennettuna, joten en sen asentamiseen tässä kohti palaa.  

Itse testauksen tässä kohdassa tein uudelleen harjoituksen vuoksi. Tein käyttäjäni hakemistoon uuden kansion `mkdir vagrantharkka`, jonka sisälle loin itse asennustiedoston `vagrant init debian/bullseye64`. 
Eli samalla määrittelin tulevan virtuaalikoneen olevan Debianin versio Bullseye ja 64 bittinen. Tarkistin `ls`, että Vagrantfile on luotuna, ja olihan se.

    PS C:\Users\murok> cd .\vagrantharkka\
    PS C:\Users\murok\vagrantharkka> vagrant init debian/bullseye64
    A `Vagrantfile` has been placed in this directory. You are now
    ready to `vagrant up` your first virtual environment! Please read
    the comments in the Vagrantfile as well as documentation on
    `vagrantup.com` for more information on using Vagrant.
    PS C:\Users\murok\vagrantharkka> ls


        Directory: C:\Users\murok\vagrantharkka


    Mode                 LastWriteTime         Length Name
    ----                 -------------         ------ ----
    -a----         12/2/2022   3:12 PM           3093 Vagrantfile
    
Avasin vielä asennustiedoston Notepadilla `notepad.exe Vagrantfile` tutustuakseni siihen vielä paremmin. En kuitenkaan tässä kohti tehnyt oletusastuksiin muutoksia.
Mutta löysin sieltä esimerkiksi kohdan, joka määrittää halutun käyttöjärjestelmän Debianin ja version.

    You can search for
      # boxes at https://vagrantcloud.com/search.
      config.vm.box = "debian/bullseye64"
      
Itse virtuaalikonetta ei ole vielä luotunua, vaan se täytyy erikseen luoda asennustiedoston teon jälkeen. Eli loin yhden virtuaalikoneen `vagrant up`. 
Mikäli haluaisin luoda useamman koneen, tulisi se erikseen määrittää Vagrantfilessa. Koneen asentamisessa kesti ehkä minuutin verran. 

    PS C:\Users\murok\vagrantharkka> vagrant up
    Bringing machine 'default' up with 'virtualbox' provider...
    ==> default: Importing base box 'debian/bullseye64'...
    ==> default: Matching MAC address for NAT networking...
    ==> default: Checking if box 'debian/bullseye64' version '11.20220912.1' is up to date...
    ==> default: Setting the name of the VM: vagrantharkka_default_1669987049918_87009
    ==> default: Clearing any previously set network interfaces...
    ==> default: Preparing network interfaces based on configuration...
        default: Adapter 1: nat
    ==> default: Forwarding ports...
        default: 22 (guest) => 2222 (host) (adapter 1)
    ==> default: Booting VM...
    ==> default: Waiting for machine to boot. This may take a few minutes...
        default: SSH address: 127.0.0.1:2222
        default: SSH username: vagrant
        default: SSH auth method: private key
        default:
        default: Vagrant insecure key detected. Vagrant will automatically replace
        default: this with a newly generated keypair for better security.
        default:
        default: Inserting generated public key within guest...
        default: Removing insecure key from the guest if it's present...
        default: Key inserted! Disconnecting and reconnecting using new SSH key...
    ==> default: Machine booted and ready!
    ==> default: Checking for guest additions in VM...
        default: The guest additions on this VM do not match the installed version of
        default: VirtualBox! In most cases this is fine, but in rare cases it can
        default: prevent things such as shared folders from working properly. If you see
        default: shared folder errors, please make sure the guest additions within the
        default: virtual machine match the version of VirtualBox you have installed on
        default: your host and reload your VM.
        default:
        default: Guest Additions Version: 6.0.0 r127566
        default: VirtualBox Version: 6.1
    ==> default: Mounting shared folders...
        default: /vagrant => C:/Users/murok/vagrantharkka

    ==> default: Machine 'default' has a post `vagrant up` message. This is a message
    ==> default: from the creator of the Vagrantfile, and not from Vagrant itself:
    ==> default:
    ==> default: Vanilla Debian box. See https://app.vagrantup.com/debian for help and bug reports

Seuraavaksi otin yhdeyten juuri luomaani virtuaalikoneeseen `vagrant ssh`. Kysyin kuka olen `whoami`, joka kertoi vastaukseksi vagrant. 
Myös nimeni konsolissa muuttui "vagrant@bullseye", eli olen onnistuneesti sisällä virtuaalikoneellani.

    PS C:\Users\murok\vagrantharkka> vagrant ssh
    Linux bullseye 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64

    The programs included with the Debian GNU/Linux system are free software;
    the exact distribution terms for each program are described in the
    individual files in /usr/share/doc/*/copyright.

    Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
    permitted by applicable law.
    vagrant@bullseye:~$ whoami
    vagrant

Testasin myös `ls`, osoittaakseni, että kone on tosiaan tyhjä. ELi mitään ei löytynyt listattuna. Sen jälkeen poistuin takaisin omalle pääkoneelleni `exit`. 

    vagrant@bullseye:~$ ls
    vagrant@bullseye:~$ exit
    logout
    Connection to 127.0.0.1 closed.

Lopuksi tuhosin virtuaalikoneen `vagrant destroy`. Tämä komento poistaa virtuaalikoneen KOKONAAN, eli sitä ei ole enää myöhemmin kaivettavissa käyttöön.
Yritinkin uudestaan ottaa ssh yhteyttä `vagrant ssh`, mutta ei onnistunut, sillä kone on jo tuhottu.

    PS C:\Users\murok\vagrantharkka> vagrant destroy
        default: Are you sure you want to destroy the 'default' VM? [y/N] y
    ==> default: Forcing shutdown of VM...
    ==> default: Destroying VM and associated drives...
    PS C:\Users\murok\vagrantharkka> ssh vagrant
    ssh: Could not resolve hostname vagrant: No such host is known.

## b) Yksityisverkko. Asenna kaksi virtuaalikonetta samaan verkkoon Vagrantilla. Laita toisen koneen nimeksi "isanta" ja toisen "renki1". Kokeile, että "renki1" saa yhteyden koneeseen "isanta" (esim. ping tai nc). Tehtävä tulee siis tehdä alusta, vaikka olisit ehtinyt kokeilla tätä tunnilla.

## c) Salt master-slave. Toteuta Salt master-slave -arkkitehtuuri verkon yli. Aseta edellisen kohdan kone renki1 orjaksi koneelle isanta.(Karvinen, 2022)

## d) Oma suola. Tee ensimmäinen työversio projektistasi. Miniprojektilla tulee olla jokin tarkoitus, vaikka se olisi keksitty. Projektilla tulee olla sivu (esim. Github, Gitlab...), josta selviää projektin perustiedot. Toiminnallisuutta tulee olla kokeiltu, mutta sen ei tarvitse olla valmis. Valmiit projektit esitellään viimeisellä tapaamiskerralla. Tässä tehtävässä palautettava työversio ei siis ole vielä lopullinen. (Karvinen, 2022)

## Lähteet:

T. Karvinen. 2018. Salt Quickstart - Salt Stack Master and Slaave on Ubuntu Linux. URL: https://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/)

T. Karvinen. 2021. Two Machine Virtual Network With Debian 11 Bullseye and Vagrant. URL: https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/

T. Karvinen. 2017. Vagrant Revisited - Install & Boot New Virtual Machine in 31 seconds. URL: https://terokarvinen.com/2017/04/11/vagrant-revisited-install-boot-new-virtual-machine-in-31-seconds/

T. Karvinen. 2022. H6 Kulkurin projekti. Palvelinten Hallinta - Configuration Management Systems. URL: https://terokarvinen.com/2022/palvelinten-hallinta-2022p2/?fromSearch=palvelinten%20hallinta#h6-kulkurin-projekti
